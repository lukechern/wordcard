# 本地单词和文章数据表的详细结构

## 本地数据表结构

### 文章数据表 (articles):

- id: Long, 自增主键
- generationTimestamp: Long, 生成时间戳
- keyWords: String, 重点单词（多个单词用逗号分隔）
- viewCount: Int, 浏览次数, 默认值为0
- apiResult: String, API返回的完整结果
- englishTitle: String, 英文文章标题
- titleTranslation: String, 标题翻译
- englishContent: String, 英文文章内容
- chineseContent: String, 中文翻译文章内容
- bilingualComparison: String, 中英对照内容, 默认值为空字符串
- isFavorite: Boolean, 是否收藏状态, 默认值为false
- author: String, 文章作者（API名称）, 默认值为空字符串

### 单词数据表 (words):

- word: String, 查询的单词, 主键
- apiResult: String, API查询的结果
- queryTimestamp: Long, 查询的时间戳
- viewCount: Int, 单词卡片被浏览的次数, 默认值为0
- isFavorite: Boolean, 是否被收藏, 默认值为false
- spellingCount: Int, 拼写练习次数, 默认值为0
- chineseDefinition: String, 中文释义, 默认值为空字符串
- phonetic: String, 音标, 默认值为空字符串
- partOfSpeech: String, 词性, 默认值为空字符串
- referenceCount: Int, 在文章中被引用的次数, 默认值为0

## CloudFlare D1 数据库建表SQL

### 手动建表步骤

1. 登录 [CloudFlare Dashboard](https://dash.cloudflare.com/)
2. 进入 `Workers & Pages` → `D1 SQL Database`
3. 选择你的数据库
4. 点击 `Console` 标签页
5. 依次执行以下SQL语句：

### 1. 创建单词表 (words)

```sql
CREATE TABLE IF NOT EXISTS words (
    word TEXT PRIMARY KEY,
    apiResult TEXT,
    queryTimestamp INTEGER,
    viewCount INTEGER,
    isFavorite INTEGER,
    spellingCount INTEGER,
    chineseDefinition TEXT,
    phonetic TEXT,
    partOfSpeech TEXT,
    referenceCount INTEGER
);
```

### 2. 创建文章表 (articles)

```sql
CREATE TABLE IF NOT EXISTS articles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    generationTimestamp INTEGER,
    keyWords TEXT,
    viewCount INTEGER,
    apiResult TEXT,
    englishTitle TEXT,
    titleTranslation TEXT,
    englishContent TEXT,
    chineseContent TEXT,
    bilingualComparison TEXT,
    isFavorite INTEGER,
    author TEXT
);
```

### 3. 创建文章单词关联表 (article_words)

```sql
CREATE TABLE IF NOT EXISTS article_words (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    article_id INTEGER,
    word TEXT NOT NULL,
    translation TEXT,
    position INTEGER,
    created_at INTEGER
);
```

### 4. 创建索引（可选，提升查询性能）

```sql
-- 单词表索引
CREATE INDEX IF NOT EXISTS idx_words_word ON words(word);

-- 文章表索引
CREATE INDEX IF NOT EXISTS idx_articles_timestamp ON articles(generationTimestamp);

-- 文章单词关联表索引
CREATE INDEX IF NOT EXISTS idx_article_words_article_id ON article_words(article_id);
CREATE INDEX IF NOT EXISTS idx_article_words_word ON article_words(word);
```

## 重要说明

### 数据类型映射
- **本地 String** → **CloudFlare D1 TEXT**
- **本地 Long** → **CloudFlare D1 INTEGER**
- **本地 Int** → **CloudFlare D1 INTEGER**
- **本地 Boolean** → **CloudFlare D1 INTEGER** (0=false, 1=true)

### 字段对应关系
所有字段名在本地和CloudFlare D1中完全一致，确保数据同步的准确性。

### 建表完成验证
建表完成后，可以在CloudFlare D1 Console中执行以下SQL验证表结构：

```sql
-- 查看words表结构
PRAGMA table_info(words);

-- 查看articles表结构
PRAGMA table_info(articles);

-- 查看article_words表结构
PRAGMA table_info(article_words);
```

### 注意事项
1. **必须手动建表**：应用不会自动创建表，需要手动在CloudFlare D1中执行建表SQL
2. **字段名严格匹配**：所有字段名必须与上述SQL完全一致
3. **数据类型准确**：确保数据类型映射正确，特别是Boolean类型使用INTEGER存储
4. **主键设置**：words表使用word作为主键，articles表使用自增id作为主键